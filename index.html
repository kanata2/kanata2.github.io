<!doctype html><html lang=ja><head><meta charset=utf-8><title>back of flyer</title><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content><meta name=author content="Naoki Kanatani"><meta name=generator content="Hugo 0.75.1"><link href=https://kanata2.dev/index.xml rel=alternate type=application/rss+xml title="back of flyer Feed"><!--[if lte IE 8]><link rel=stylesheet href=https://kanata2.dev/assets/style-compat.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://kanata2.dev/assets/style.css><!--<![endif]--></head><body><div class=pure-g><div class="pure-u-1-24 pure-u-md-5-24"></div><div class="pure-u-22-24 pure-u-md-14-24"><div class=navigation><div class="navigation-header clearfix"><div class="pure-menu pure-menu-horizontal"><a class="pure-menu-heading pure-menu-link" href=https://kanata2.dev/>back of flyer</a></div></div><div class=navigation-content><div class="pure-menu pure-menu-horizontal"><ul class=pure-menu-list><li class=pure-menu-item title="All posts"><a class=pure-menu-link href=https://kanata2.dev/posts/>Posts</a></li><li class=pure-menu-item title="All categories"><a class=pure-menu-link href=https://kanata2.dev/categories/>Categories</a></li><li class=pure-menu-item title="All tags"><a class=pure-menu-link href=https://kanata2.dev/tags/>Tags</a></li><li class=pure-menu-item title="About me"><a class=pure-menu-link href=https://kanata2.dev/about/>About</a></li></ul></div></div></div><div><div><h2 class=post-title><a href=https://kanata2.dev/posts/2020-12-25-snowflake-resource-monitor-noti/>Snowflake のリソースモニター通知を Slack で受け取る</a></h2><div class=post-meta><span>Date</span> [
<time datetime=2020-12-25T02:27:52+09:00>25 Dec 20 02:27 +0900</time>
]</div></div><div><p>Snowflake にはコスト管理や予期しない使用状況回避のためにリソースモニターという仕組みがあるが、<br>現状アカウント管理者に Web インターフェイスまたはメールを通してのみ通知される点がちょっと使いづらい。<br>というわけで、この通知を Slack に流して誰でも確認できるようにしているよという tips メモを残しておく。</p><p>Slack には<a href=https://slack.com/help/articles/206819278-Send-emails-to-Slack>チャンネルにメールを流す仕組み</a>があるので、これを使う。<br>手順に従って取得したメールアドレスを ACCOUNTADMIN ロールを持つユーザのメールアドレスとして設定し、ウェブ上から通知を有効化・電子メール受け取りに変更するのみ。</p><div class=highlight><pre class=chroma><code class=language-sql data-lang=sql><span class=k>alter</span> <span class=k>user</span> <span class=o>&lt;</span><span class=n>admin_user</span><span class=o>&gt;</span> <span class=k>set</span> <span class=n>email</span> <span class=o>=</span> <span class=s1>&#39;x-hoge@xxx.org.slack.com&#39;</span><span class=p>;</span>
</code></pre></div><p>これだけ。<br>通知の有効化も SQL でやりたいなとか非管理者も通知を受け取りたいな、メールと Web 以外でも通知を受け取りたいなという気持ちではあるが、一旦はこれでなんとかなるので今後のアップデートに期待したい。</p></div></div><div class=post-divider><div><h2 class=post-title><a href=https://kanata2.dev/about/>About me</a></h2><div class=post-meta><span>Date</span> [
<time datetime=2020-01-24T02:25:00+09:00>24 Jan 20 02:25 +0900</time>
]</div></div><div><ul><li><p>名前: 金谷直輝(Naoki Kanatani)</p></li><li><p>所属: CyberAgent, Inc.</p></li><li><p>経歴:</p><ul><li>2012 / 04 - 2016 / 03: 東京工業大学情報工学部</li><li>2016 / 04 - 2018 / 03: 東京工業大学情報理工学院</li><li>2018 / 04 - 現在: CyberAgent, Inc.</li></ul></li><li><p>リンク:</p><ul><li><a href=https://twitter.com/kanata2n>Twitter</a></li><li><a href=https://github.com/kanata2>GitHub</a></li><li><a href=https://www.linkedin.com/in/naoki-kanatani/>LinkedIn</a></li></ul></li></ul></div></div><div class=post-divider><div><h2 class=post-title><a href=https://kanata2.dev/posts/elasticache-scaleup/>ElastiCache のノードタイプを変更する際の注意点</a></h2><div class=post-meta><span>Date</span> [
<time datetime=2019-12-20T10:00:00+09:00>20 Dec 19 10:00 +0900</time>
]</div></div><div><p>注意: この記事は <code>aws elasticache list-allowed-node-type-modifications</code> を知っていれば(ほぼ)読む必要はありません。</p><h3 id=背景>背景</h3><p>今見ているサービスで RI の購入タイミングになったので、m4.4xlarge のものを m5.4xlarge に変更しようという話になりました。<br>しかし、実際にオペレーションをしたところ変更ができなかったのでスケール時に確認しておくべきことなどを自分用にメモとして残しておきます。<br>(いやその変更は直接は無理でしょ！と一瞬で分かった方には不要な記事です)</p><h3 id=原因事前にやっておくべきこと>原因・事前にやっておくべきこと</h3><p>結論から述べると、<a href=https://docs.aws.amazon.com/ja_jp/AmazonElastiCache/latest/red-ug/Scaling.RedisReplGrps.ScaleUp.html>ドキュメント</a>に記載してある通り、スケールアップ先として選択可能なノードとそうでないノードが存在します。<br>AWS CLI であれば <code>aws elasticache list-allowed-node-type-modifications</code> を使うのが良いです。</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>
$ aws elasticache list-allowed-node-type-modifications --replication-group-id xxxxx
<span class=o>{</span>
    <span class=s2>&#34;ScaleUpModifications&#34;</span>: <span class=o>[</span>
        <span class=s2>&#34;cache.m4.10xlarge&#34;</span>,
        <span class=s2>&#34;cache.m5.12xlarge&#34;</span>,
        <span class=s2>&#34;cache.m5.24xlarge&#34;</span>,
        <span class=s2>&#34;cache.r3.4xlarge&#34;</span>,
        <span class=s2>&#34;cache.r3.8xlarge&#34;</span>,
        <span class=s2>&#34;cache.r4.16xlarge&#34;</span>,
        <span class=s2>&#34;cache.r4.4xlarge&#34;</span>,
        <span class=s2>&#34;cache.r4.8xlarge&#34;</span>,
        <span class=s2>&#34;cache.r5.12xlarge&#34;</span>,
        <span class=s2>&#34;cache.r5.24xlarge&#34;</span>,
        <span class=s2>&#34;cache.r5.4xlarge&#34;</span>
    <span class=o>]</span>,
    <span class=s2>&#34;ScaleDownModifications&#34;</span>: <span class=o>[</span>
        <span class=s2>&#34;cache.m3.2xlarge&#34;</span>,
        <span class=s2>&#34;cache.m3.large&#34;</span>,
        <span class=s2>&#34;cache.m3.medium&#34;</span>,
        <span class=s2>&#34;cache.m3.xlarge&#34;</span>,
        <span class=s2>&#34;cache.m4.2xlarge&#34;</span>,
        <span class=s2>&#34;cache.m4.large&#34;</span>,
        <span class=s2>&#34;cache.m4.xlarge&#34;</span>,
        <span class=s2>&#34;cache.r3.2xlarge&#34;</span>,
        <span class=s2>&#34;cache.r3.large&#34;</span>,
        <span class=s2>&#34;cache.r3.xlarge&#34;</span>,
        <span class=s2>&#34;cache.r4.large&#34;</span>,
        <span class=s2>&#34;cache.r4.xlarge&#34;</span>,
        <span class=s2>&#34;cache.t2.medium&#34;</span>,
        <span class=s2>&#34;cache.t2.micro&#34;</span>,
        <span class=s2>&#34;cache.t2.small&#34;</span>,
        <span class=s2>&#34;cache.t3.medium&#34;</span>,
        <span class=s2>&#34;cache.t3.micro&#34;</span>,
        <span class=s2>&#34;cache.t3.small&#34;</span>
    <span class=o>]</span>
<span class=o>}</span>
</code></pre></div><h3 id=なぜ変更できないのか>なぜ変更できないのか</h3><p>ドキュメントには詳細な仕様は明記されていません。<br>今回のケースでは「別のノードタイプに変更する場合は現在よりメモリの小さいものには変更できない」というルールが存在していてそれに引っかかったのだと思われます。<br>また、これ以外にも変更に関するルールは存在するようなので、必ず事前に調べておく必要があります。</p><h3 id=どうしても変更したい>どうしても変更したい</h3><p>という場合もあるかと思います。その場合は、</p><ol><li>同ノードタイプの現在よりメモリの小さいものに一旦変更</li></ol><ul><li>例: m4.4xlarge -> m4.2xlarge</li></ul><ol start=2><li>当初変更予定だったノードタイプに変更</li></ol><ul><li>例: m4.2xlarge -> m5.4xlarge</li></ul><p>という手順で理論的には変更可能です。(こちらはサポートケースでも案内されました)</p></div></div><div class=post-divider><div><h2 class=post-title><a href=https://kanata2.dev/posts/hugo-and-github-pages-and-github-actions/>Hugo + GitHub Pages + GitHub Actions でこの記事を世に届けている</a></h2><div class=post-meta><span>Date</span> [
<time datetime=2019-09-11T12:10:48+09:00>11 Sep 19 12:10 +0900</time>
]</div></div><div><p>最近自分のアカウントも GitHub Actions が有効になったので、<br>早速使ってみようと思いこの GitHub Pages を Actions でリリースするようにしてみた。<br>実際の YAML を見るのが早いと思うので貼る。以下の通り。</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>publish</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>develop</span><span class=w>
</span><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>build-deploy</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@master</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-hugo@v0.58.1</span><span class=w>
</span><span class=w>      </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>args</span><span class=p>:</span><span class=w> </span>--<span class=l>gc --minify --cleanDestinationDir</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-gh-pages@v2.2.0</span><span class=w>
</span><span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>ACTIONS_DEPLOY_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.ACTIONS_DEPLOY_KEY }}</span><span class=w>
</span><span class=w>        </span><span class=nt>PUBLISH_BRANCH</span><span class=p>:</span><span class=w> </span><span class=l>master</span><span class=w>
</span><span class=w>        </span><span class=nt>PUBLISH_DIR</span><span class=p>:</span><span class=w> </span><span class=l>./public</span><span class=w>
</span></code></pre></div><p>すでに世に出回っている Action が便利なのでそれを使うだけの記事になってしまった。</p><h4 id=参考>参考</h4><ul><li><a href=https://github.com/marketplace/actions/deploy-action-for-github-pages>https://github.com/marketplace/actions/deploy-action-for-github-pages</a></li></ul></div></div><div class=post-divider><div><h2 class=post-title><a href=https://kanata2.dev/posts/my-first-post/>ハローワールド</a></h2><div class=post-meta><span>Date</span> [
<time datetime=2019-09-10T00:35:16+09:00>10 Sep 19 00:35 +0900</time>
]</div></div><div><p>文章を書きたいけどどこに書こうか迷った結果 GitHub Pages にたどり着いた。</p></div></div><div class=footer><div class="pure-menu pure-menu-horizontal"><ul class=pure-menu-list><li class=pure-menu-item title=kanata2><a class=pure-menu-link href=https://github.com/kanata2>GitHub</a></li><li class=pure-menu-item title=kanata2><a class=pure-menu-link href=https://gitlab.com/kanata2>GitLab</a></li><li class=pure-menu-item title=kanata2n><a class=pure-menu-link href=https://twitter.com/kanata2n>Twitter</a></li><li class=pure-menu-item title="RSS Feed"><a href=https://kanata2.dev/index.xml class=pure-menu-link>RSS</a></li><li class="pure-menu-item fix-cursor-pointer" title="Go to top"><a class=pure-menu-link id=btn-gototop><span class=fix-placement-up>&#8679;&#xfe0e;</span></a></li></ul></div></div><script>function setElementsClass(selector,value){Array.prototype.forEach.call(document.querySelectorAll(selector),function(elem){elem.className=value;});}
setElementsClass('img','pure-img');setElementsClass('table','pure-table');function onResize(){Array.prototype.forEach.call([{selector:'.pure-menu',hi:'pure-menu pure-menu-horizontal',lo:'pure-menu'},{selector:'.navigation-header-subtitle',hi:'pure-menu-list navigation-header-subtitle pull-end',lo:'pure-menu-list navigation-header-subtitle'},{selector:'.navigation-header',hi:'navigation-header clearfix',lo:'navigation-header'}],function(elem){setElementsClass(elem.selector,document.documentElement.clientWidth>=768?elem.hi:elem.lo);});}
onResize();window.addEventListener('resize',onResize);document.getElementById('btn-gototop').addEventListener('click',function(){function scroll(){if(window.pageYOffset>0){setTimeout(scroll,8);}
window.scroll(0,window.pageYOffset-128);}
scroll();});</script></div><div class="pure-u-1-24 pure-u-md-5-24"></div></div></body></html>